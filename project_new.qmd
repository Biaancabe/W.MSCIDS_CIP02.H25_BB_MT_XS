---
title: "Corporate ESG Performance and Financial Market Performance"
author: "Xinmeng Song, Bianca Bernasconi & Marisa Timm (group 107)"
date: "07 November 2025"

lang: en-GB
bibliography: references.bib
csl: apa.csl

format:
  pdf:
    documentclass: scrartcl
    papersize: A4
    geometry: margin=2.5cm
    link-citations: true
    number-sections: true
    toc: false

engine: jupyter
jupyter: "quarto-venv"

execute:
  echo: false
  input: false
  output: false
  warning: false
  message: false
  fig-width: 4        
  fig-height: 2       
  out-width: "60%"
---

```{python}
#| label: libraires
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
import statsmodels.formula.api as smf
import statsmodels.api as sm
from pathlib import Path
from sklearn.preprocessing import StandardScaler

```

# Introduction and Motivation

ESG performance has become an important factor in corporate strategy and financial markets. Meta-analyses show that a majority of studies find a positive relationship between ESG scores. However, there is also a non-negligible share of research reports that report neutral or even negative effects. [@Friede2015; @WhelanAtzClark2021] Our project focuses on Swiss companies to examine whether ESG scores are positively linked to financial performance.

Our research questions are therefore:

1. What is the relationship between ESG scores and financial performance for Swiss listed companies?
2. What is the effect of the industry type on this relationship, focusing on the top 5 industries in Switzerland?
3. If there is a clear dependency of ESG on financial performance, how do the individual effects of Environmental (E), Social (S), and Governance (G) factors compare in explaining this relationship?
4. How does the relationship between financial performance and ESG scores behave of Swiss companies compared to peers worldwide?

# Methods
## Data Acquisition

We collect data from two main company groups:

- Swiss companies listed in the Swiss Performance Index (SPI), which includes 201 companies across various sectors. 
- U.S. companies from the S&P 500 Index as a global benchmark, which includes 503 leading listed companies.

For both datasets, financial and ESG data were retrieved via the Yahoo Finance API by company ticker. Since the API does not provide official documentation, we found two reliable public technical references ([Ranaroussi‚Äôs yfinance Documentation](https://ranaroussi.github.io/yfinance/reference/index.html) and the [AlgoTrading101 API Guide](https://algotrading101.com/learn/yahoo-finance-api-guide/) that we can consult to ensure data accuracy and consistency. We developed a Python script to extract data via the Yahoo Finance API. By modifying the input parameter (`swiss_companies.txt` and `S&P_companies.txt`), we generated separate datasets for Swiss and S&P companies. The complete implementation can be found in the Data folder as data_acquisition.py.

Company tickers were first collected from Wikipedia ([SPI](https://en.wikipedia.org/wiki/Swiss_Performance_Index), [S&P 500](https://en.wikipedia.org/wiki/List_of_S%26P_500_companies)), and for the SPI we validated the list against a real-time source from [Investing.com](https://www.investing.com/indices/swiss-performance-components) (as of 2025-10-17). Mismatches were resolved via Excel‚Äôs VLOOKUP and manual checks. Finalized tickers were stored in company_list.xlsx.

Variables collected cover company information, financial indicators, and ESG scores:

1. Company Information: name, ticker, country, sector, industry, currency.
2. Financial and Market data, including **Stock Price**, **Profitability Metrics** (Revenue, Net Income, Operating Margin, Gross Margin, ROE, ROA, Profit Margin, EBITDA Margin, and EPS), **Valuation Metrics** (Market Capitalization, P/E Ratio, P/B Ratio, and Annual Return), **Risk and Stability Metrics** (Beta, Debt-to-Equity Ratio, Current Ratio, and (Operating Cash Flow), **Revenue Growth**.
3. ESG Scores: Total ESG Score, Environmental / Social / Governance sub-scores, Highest Controversy, and ESG Performance Category.

All financial data correspond to a **2024-12-31** snapshot, ensuring alignment with the same reporting period as the ESG scores.

## Data Cleansing
```{python}
#| label: load-data
spi = pd.read_csv(Path("Data/esg_financial_analysis_spi.csv"))
sp500 = pd.read_csv(Path("Data/esg_financial_analysis_sp500.csv"))
```

```{python}
#| label: SPI-overview
print(spi.shape)
spi.describe()
```

```{python}
#| label: SPI500-overview
print(sp500.shape)
sp500.describe()
```

```{python}
#| label: missing-data-function
def missing_summary(df, name):
    missing_count = df.isnull().sum()
    missing_pct = (missing_count / len(df) * 100).round(2)
    return pd.DataFrame({
        "Dataset": name,
        "Missing Count": missing_count,
        "Missing %": missing_pct
    })
```

```{python}
#| label: missing-data-SPI
missing_summary(spi, "SPI")
```

```{python}
#| label: missing-data_SP500
missing_summary(sp500, "SP500")
```

```{python}
#| label: missing-esg-data
def check_esg_missing(df, name):
    """Check proportion of missing ESG scores"""
    esg_columns = ['Total_ESG_Score', 'Environmental_Score', 'Social_Score', 'Governance_Score', 'ESG_Performance', 'Highest_Controversy']
    esg_scores_columns = ['Total_ESG_Score', 'Environmental_Score', 'Social_Score', 'Governance_Score']
    
    print(f"\n{name} - ESG Data Availability:")
    for col in esg_columns:
        if col in df.columns:
            missing_count = df[col].isnull().sum()
            missing_pct = (missing_count / len(df) * 100)
            print(f"  {col}: {missing_count}/{len(df)} missing ({missing_pct:.2f}%)")
    
    # Overall ESG availability
    has_total_esg = df[['Total_ESG_Score']].notnull().all(axis=1)
    has_all_esg_scores = df[esg_scores_columns].notnull().all(axis=1)
    has_all_esg_data = df[esg_columns].notnull().all(axis=1)
    companies_with_total_esg = has_total_esg.sum()
    companies_without_total_esg = len(df) - companies_with_total_esg
    companies_with_all_esg_scores = has_all_esg_scores.sum()
    companies_with_all_esg_data = has_all_esg_data.sum()
    
    print(f"\n  Companies WITHOUT Total ESG scores: {companies_without_total_esg} ({companies_without_total_esg/len(df)*100:.2f}%)")
    print(f"  Companies WITH Total ESG score: {companies_with_total_esg} ({companies_with_total_esg/len(df)*100:.2f}%)")
    print(f"  Companies WITH all ESG scores: {companies_with_all_esg_scores} ({companies_with_all_esg_scores/len(df)*100:.2f}%)")
    print(f"  Companies WITH all ESG data: {companies_with_all_esg_data} ({companies_with_all_esg_data/len(df)*100:.2f}%)")

spi_no_esg = check_esg_missing(spi, "SPI")
sp500_no_esg = check_esg_missing(sp500, "S&P 500")
```

```{python}
#| label: spi-esg-drop-na
spi_esg = spi.dropna(subset=['Total_ESG_Score'])
print(spi_esg.shape)
print(spi_esg['Total_ESG_Score'].isnull().sum())
```

```{python}
#| label: sp500-esg-drop-na
sp500_esg = sp500.dropna(subset=['Total_ESG_Score'])
print(sp500_esg.shape)
print(sp500_esg['Total_ESG_Score'].isnull().sum())
```

First, by checking the missing ESG data, we found that only 71/201 SPI companies had full ESG data and 142/201 had Total ESG Scores. To maintain sample size, we only removed firms without Total ESG Score. Then, we examined the country distribution to ensure dataset consistency. Since 5/201 SPI firms were non-Swiss, we removed them to maintain comparability. In the S&P 500 dataset, 96% were US-based, so non-US firms were also removed. We also checked and guaranteed that no overlap existed between SPI and S&P 500 companies. Besides, 1 duplicate (SCHN.SW vs. SCHP.SW) was resolved by keeping the registered share ticker, and a missing company name (Galderma) was manually filled in this part.

A few financial variables (e.g., ROE%, Beta, Revenue) contained sporadic missing values. To ensure consistency, we dropped variables with extensive missing data or redundancy, please check the data prep code for more details.

After cleaning, we retained 134 Swiss companies (SPI) and 280 U.S. companies (S&P 500) for subsequent analysis.

```{python}
#| label: non_swiss-spi_esg-count
non_swiss = spi_esg[spi_esg["Country"] != "Switzerland"]
print(non_swiss[['Ticker', 'Company_Name', 'Country', 'Total_ESG_Score']].to_string())
```

```{python}
#| label: spi-esg-remove-non-swiss
spi_esg = spi_esg[spi_esg["Country"] == "Switzerland"]
```

```{python}
#| label: check-sp500-swiss
sp500_swiss = sp500_esg[sp500_esg["Country"] == "Switzerland"]
print(sp500_swiss[['Ticker', 'Company_Name', 'Country', 'Total_ESG_Score']].to_string())
```

```{python}
#| label: check_duplicates-sp500
check_duplicates = sp500_esg['Company_Name'].tolist()
matching_spi = spi_esg[spi_esg['Company_Name'].isin(check_duplicates)]

print(matching_spi[['Ticker', 'Company_Name', 'Country', 'Total_ESG_Score']].to_string())
```

```{python}
#| label: country_counts-sp500

country_counts = sp500_esg['Country'].value_counts(dropna=False)
country_pct = (country_counts / len(sp500_esg) * 100).round(2)

country_summary = pd.DataFrame({
    'Count': country_counts,
    'Percentage (%)': country_pct
})

print("S&P 500 ‚Äî Country distribution:")
display(country_summary)
```

```{python}
#| label: sp500_non-us
sp500_nonUS = sp500_esg[sp500_esg["Country"] != "United States"]
print(sp500_nonUS[['Ticker', 'Company_Name', 'Country', 'Total_ESG_Score']].to_string())
```

```{python}
#| label: sp500-US-only
sp500_esg = sp500_esg[sp500_esg["Country"] == "United States"]
```

```{python}
#| label: spi-company_name-na
spi_esg[spi_esg["Company_Name"].isna()]
```

```{python}
#| label: spi-company_name-fillna
spi_esg['Company_Name'].fillna("Galderma", inplace=True)
spi_esg[spi_esg["Company_Name"].isna()]
```

```{python}
#| label: sp500-company_name-na
sp500_esg[sp500_esg["Company_Name"].isna()]
```

```{python}
#| label: spi_duplicates

spi_duplicates = spi_esg[spi_esg.duplicated(subset=['Company_Name'], keep=False)]
print(spi_duplicates.to_string())
```

```{python}
#| label: spi-remove-duplicates
# Keep SCHN.SW (Registered Shares) and remove SCHP.SW (Participation Certificates)
# since SCHN.SW reflects the company‚Äôs core ESG profile
spi_esg = spi_esg[spi_esg["Ticker"] != "SCHP.SW"]
spi_esg.shape
```

```{python}
#| label: sp500_duplicates
sp500_duplicates = sp500_esg[sp500_esg.duplicated(subset=['Company_Name'], keep=False)]
print(sp500_duplicates[['Ticker', 'Company_Name', 'Total_ESG_Score','Environmental_Score', 'Stock_Price']].to_string())
```

```{python}
#| label: sp500_esg-shape
sp500_esg.shape
```

```{python}
#| label: summary-spi_esg-spi
missing_summary(spi_esg, "SPI")
```

```{python}
#| label: missing_minor_columns
missing_minor_columns = [
    'Highest_Controversy', 'Stock_Price', 'Revenue',
    'ROE_Pct', 'ROA_Pct', 'Beta'
]

spi_missing_minor_data = spi_esg[spi_esg[missing_minor_columns].isnull().any(axis=1)]
print(spi_missing_minor_data[['Company_Name'] + missing_minor_columns].to_string(index=False))
```

```{python}
#| label: summary-sp500_esg-sp50
missing_summary(sp500_esg, "SP500")
```

```{python}
#| label: remove-columns-with-large-missing-data
# Remove columns with large missing data
missing_large_columns = [
    'PE_Ratio', 'EBITDA_Margin_Pct', 'Debt_to_Equity',
    'Current_Ratio', 'Operating_Cash_Flow'
]
spi_esg = spi_esg.drop(columns=missing_large_columns)
sp500_esg = sp500_esg.drop(columns=missing_large_columns)
```

For data type and range checks, numeric, categorical, and date columns were standardized. Value ranges were validated (e.g., ESG scores 0‚Äì100, controversy level 0‚Äì5). Given some companies can have extreme margins and returns, out-of-range values were treated as warnings rather than removed.

```{python}
#| label: spi_esg-dtypes
spi_esg.dtypes
```

```{python}
#| label: def-fix_datatypes-df-name
def fix_datatypes(df, name):
    """Ensure columns have appropriate data types"""
    print(f"\n{name} - Fixing Data Types:")
    
    # Numeric columns that should be float
    numeric_cols = ['Total_ESG_Score', 'Environmental_Score', 'Social_Score', 'Governance_Score',
                'Stock_Price', 'Current_Price', 'Market_Cap', 'PB_Ratio', 'Annual_Return_Pct',
                'Revenue', 'Net_Income', 'Operating_Margin_Pct', 'Gross_Margin_Pct', 'ROE_Pct', 'ROA_Pct',
                'Profit_Margin_Pct', 'EPS', 'Beta', 'Revenue_Growth_Pct']

    for col in numeric_cols:
        if col in df.columns:
            original_type = df[col].dtype
            df[col] = pd.to_numeric(df[col], errors='coerce')
            if original_type != df[col].dtype:
                print(f"  {col}: {original_type} ‚Üí {df[col].dtype}")
    
    # Integer columns
    int_cols = ['Highest_Controversy']
    for col in int_cols:
        if col in df.columns:
            original_type = df[col].dtype
            df[col] = pd.to_numeric(df[col], errors='coerce')
            if original_type != df[col].dtype:
                print(f"  {col}: {original_type} ‚Üí {df[col].dtype}")
    
    # Categorical columns
    categorical_cols = ['Currency', 'Sector', 'Industry', 'Country', 'ESG_Performance', 'Status']
    for col in categorical_cols:
        if col in df.columns:
            original_type = df[col].dtype
            df[col] = df[col].astype('category')
            if str(original_type) != 'category':
                print(f"  {col}: {original_type} ‚Üí category")
    
    # Date column
    if 'Data_Date' in df.columns:
        df['Data_Date'] = pd.to_datetime(df['Data_Date'], errors='coerce')
        print(f"  Data_Date: ‚Üí datetime64")

    # Object column
    for col in ['Ticker', 'Company_Name']:
        if col in df.columns:
            original_type = df[col].dtype
            df[col] = df[col].astype(object)
            if original_type != df[col].dtype:
                print(f"  {col}: {original_type} ‚Üí object")
    
    return df

spi_esg = fix_datatypes(spi_esg, "SPI")
sp500_esg = fix_datatypes(sp500_esg, "S&P 500")
```

```{python}
#| label: def-check_value_ranges-df-name
def check_value_ranges(df, name):
    """Check value ranges and return DataFrame of all exceptions (errors + warnings) without deleting rows"""
    print(f"\n{name} - Value Range Checks:")

    warnings_list = []

    # ESG scores should be 0-100
    esg_cols = ['Total_ESG_Score', 'Environmental_Score', 'Social_Score', 'Governance_Score']
    for col in esg_cols:
        if col in df.columns:
            invalid = (df[col] < 0) | (df[col] > 100)
            if invalid.sum() > 0:
                print(f"  ERROR in {col}: {invalid.sum()} values outside [0, 100]")
                warnings_list.append(df.loc[invalid, ['Company_Name', col]])

    # Controversy should be 0-5
    if 'Highest_Controversy' in df.columns:
        invalid = (df['Highest_Controversy'] < 0) | (df['Highest_Controversy'] > 5)
        if invalid.sum() > 0:
            print(f"  ERROR in Highest_Controversy: {invalid.sum()} values outside [0, 5]")
            warnings_list.append(df.loc[invalid, ['Company_Name', 'Highest_Controversy']])

    # Stock prices should be positive
    for col in ['Stock_Price', 'Current_Price']:
        if col in df.columns:
            invalid = df[col] <= 0
            if invalid.sum() > 0:
                print(f"  ERROR in {col}: {invalid.sum()} non-positive values")
                warnings_list.append(df.loc[invalid, ['Company_Name', col]])

    # Market cap should be positive
    if 'Market_Cap' in df.columns:
        invalid = df['Market_Cap'] <= 0
        if invalid.sum() > 0:
            print(f"  ERROR in Market_Cap: {invalid.sum()} non-positive values")
            warnings_list.append(df.loc[invalid, ['Company_Name', 'Market_Cap']])

    # Margins reasonable (-100% to 100%)
    margin_cols = ['Operating_Margin_Pct', 'Gross_Margin_Pct', 'Profit_Margin_Pct']
    for col in margin_cols:
        if col in df.columns:
            invalid = (df[col] < -100) | (df[col] > 100)
            if invalid.sum() > 0:
                print(f"  WARNING in {col}: {invalid.sum()} values outside [-100, 100]")
                warnings_list.append(df.loc[invalid, ['Company_Name', col]])

    # ROE and ROA reasonable (-100% to 200%)
    for col in ['ROE_Pct', 'ROA_Pct']:
        if col in df.columns:
            invalid = (df[col] < -100) | (df[col] > 200)
            if invalid.sum() > 0:
                print(f"  WARNING in {col}: {invalid.sum()} values outside [-100, 200]")
                warnings_list.append(df.loc[invalid, ['Company_Name', col]])

    # Combine warning/error rows
    if warnings_list:
        df_errors = pd.concat(warnings_list).drop_duplicates()
    else:
        df_errors = pd.DataFrame(columns=df.columns)

    print(f"  Total rows with warnings/errors: {df_errors.shape[0]}")
    return df_errors
```

```{python}
#| label: spi_esg_errors-check_value_ranges
spi_esg_errors = check_value_ranges(spi_esg, "SPI")
sp500_esg_errors = check_value_ranges(sp500_esg, "S&P 500")

print(spi_esg_errors)
```

```{python}
#| label: print-sp500_esg_errors
print(sp500_esg_errors)
```

```{python}
#| label: categorical_cols-currency-sect
categorical_cols = ['Currency', 'Sector', 'Industry', 'Country', 'ESG_Performance', 'Status']
for col in categorical_cols:
    print(col)
    print(spi_esg[col].value_counts())
```

```{python}
#| label: for-col-in-categorical_cols
for col in categorical_cols:
    print(col)
    print(sp500_esg[col].value_counts())
```

```{python}
#| label: cell-80-print-spi_esg-highest_controversy
print(spi_esg['Highest_Controversy'].value_counts())
```

```{python}
#| label: sp500_esg-highest_controversy
print(sp500_esg['Highest_Controversy'].value_counts())
```

Outliers were identified using the IQR method. Given the limited ESG sample size, we retained extreme values at this stage, as they may represent valid observations. Outlier treatment will be revisited during the analysis phase based on metric distributions.

```{python}
#| label: def-identify_outliers
def identify_outliers(df, name):
    """Identify outliers using IQR method"""
    print(f"\n{name} - Outlier Detection:")

    numeric_cols = ['Total_ESG_Score', 'Environmental_Score', 'Social_Score', 'Governance_Score',
                'Stock_Price', 'Current_Price', 'Market_Cap', 'PB_Ratio', 'Annual_Return_Pct',
                'Revenue', 'Net_Income', 'Operating_Margin_Pct', 'Gross_Margin_Pct', 'ROE_Pct', 'ROA_Pct',
                'Profit_Margin_Pct', 'EPS', 'Beta', 'Revenue_Growth_Pct']

    outlier_summary = {}

    for col in numeric_cols:
        if col in df.columns and df[col].notna().sum() > 0:
            Q1 = df[col].quantile(0.25)
            Q3 = df[col].quantile(0.75)
            IQR = Q3 - Q1
            
            lower_bound = Q1 - 3 * IQR  # Using 3*IQR for extreme outliers only
            upper_bound = Q3 + 3 * IQR
            
            outliers = (df[col] < lower_bound) | (df[col] > upper_bound)
            outlier_count = outliers.sum()
            
            if outlier_count > 0:
                outlier_summary[col] = {
                    'count': outlier_count,
                    'percentage': outlier_count / df[col].notna().sum() * 100,
                    'lower_bound': lower_bound,
                    'upper_bound': upper_bound,
                    'outlier_indices': df[outliers].index.tolist()
                }
                
                print(f"\n  {col}:")
                print(f"    Outliers found: {outlier_count} ({outlier_count/df[col].notna().sum()*100:.2f}%)")
                print(f"    Expected range: [{lower_bound:.2f}, {upper_bound:.2f}]")
                print(f"    Actual range: [{df[col].min():.2f}, {df[col].max():.2f}]")
    
    return outlier_summary
```

```{python}
#| label: spi_outliers-identify_outliers
spi_outliers = identify_outliers(spi_esg, "SPI")
```

```{python}
#| label: p500_outliers
sp500_outliers = identify_outliers(sp500_esg, "S&P 500")
```

```{python}
#| label: plot_outliers-df-name

def plot_outliers(df, name):
    """Plot boxplots for numeric columns to visualize outliers"""
    numeric_cols = ['Total_ESG_Score', 'Environmental_Score', 'Social_Score', 'Governance_Score',
                    'Stock_Price', 'Current_Price', 'Market_Cap', 'PB_Ratio', 'Annual_Return_Pct',
                    'Revenue', 'Net_Income', 'Operating_Margin_Pct', 'Gross_Margin_Pct', 'ROE_Pct', 'ROA_Pct',
                    'Profit_Margin_Pct', 'EPS', 'Beta', 'Revenue_Growth_Pct']

    for col in numeric_cols:
        if col in df.columns and df[col].notna().sum() > 0:
            plt.figure(figsize=(8, 4))
            sns.boxplot(x=df[col], showfliers=True)
            plt.title(f"{name} - {col} Boxplot with Outliers")
            plt.xlabel(col)
            plt.show()
```

```{python}
#| label: plot_outliers-spi
plot_outliers(spi_esg, "SPI")
```

Finally, we enriched the dataset with additional attributes and prepares it for analysis. A Company_Type column was added to distinguish between SPI and S&P 500 firms in the later merged dataset. Companies were classified into five ESG Risk Categories (Negligible, Low, Medium, High, Severe) based on [ESG Risk Ratings Methodology](https://www.sustainalytics.com/docs/knowledgehublibraries/default-document-library/sustainalytics_-esg-risk-ratings_-version-3-1_-methodology-abstract_-june-2024.pdf), where lower scores indicate lower risk.

After the SPI and S&P 500 datasets were merged, redundant columns with identical values were removed, and the cleaned combined dataset was saved as ‚ÄúData/cleaned_combined_data.csv.‚Äù

```{python}
#| label: company_type
spi_esg['Company_Type'] = "SPI"
sp500_esg['Company_Type'] = "S&P 500"
```

```{python}
#| label: categorize_esg_risk-score
def categorize_esg_risk(score):
    if pd.isna(score):
        return np.nan
    elif score < 10:
        return 'Negligible'
    elif score < 20:
        return 'Low'
    elif score < 30:
        return 'Medium'
    elif score < 40:
        return 'High'
    else:
        return 'Severe'
    
spi_esg['ESG_Risk_Category'] = spi_esg['Total_ESG_Score'].apply(categorize_esg_risk)
spi_esg['ESG_Risk_Category'] = spi_esg['ESG_Risk_Category'].astype('category')
```

```{python}
#| label: risk_category-in-data
sp500_esg['ESG_Risk_Category'] = sp500_esg['Total_ESG_Score'].apply(categorize_esg_risk)
sp500_esg['ESG_Risk_Category'] = sp500_esg['ESG_Risk_Category'].astype('category')
```

```{python}
#| label: cols-list
cols = list(spi_esg.columns)
cols.remove('Company_Type')
idx = cols.index('Company_Name') + 1
cols.insert(idx, 'Company_Type')
spi_esg = spi_esg[cols]
```

```{python}
#| label: cols-list2
cols = list(spi_esg.columns)
cols.remove('ESG_Risk_Category')
idx = cols.index('Country') + 1
cols.insert(idx, 'ESG_Risk_Category')
spi_esg = spi_esg[cols]
```

```{python}
#| label: cols-list-sp500
cols = list(sp500_esg.columns)
cols.remove('Company_Type')
idx = cols.index('Company_Name') + 1
cols.insert(idx, 'Company_Type')

cols.remove('ESG_Risk_Category')
idx = cols.index('Country') + 1
cols.insert(idx, 'ESG_Risk_Category')

sp500_esg = sp500_esg[cols]
```

```{python}
#| label: clean
esg_clean = pd.concat([spi_esg, sp500_esg], ignore_index=True)
```

```{python}
#| label: cols_to_drop
cols_to_drop = [col for col in esg_clean.columns if esg_clean[col].nunique() == 1]

esg_clean = esg_clean.drop(columns=cols_to_drop)

print("Dropped columns:", cols_to_drop)
```

```{python}
#| label: to_csv
esg_clean.to_csv("Data/cleaned_combined_data.csv", index=False)
```

# Analysis & discussion of results

## RQ1: Relationship between financial performance and ESG

Firstly, we look at the dataset for the analysis more closely:

```{python}
#| label: prepare-dataset
# only SPI dataset from merged data
ch = esg_clean.query("Company_Type == 'SPI'").copy()

# log transformed market cap to smoothen extreme values
ch["log_mc"] = np.log1p(ch["Market_Cap"])

#choose only those entries with complete data in the necessary variables
vars_needed_1 = [
    "Annual_Return_Pct",
    "Total_ESG_Score",
    "log_mc",
    "Revenue_Growth_Pct",
    "Industry"
]

# drop rows with missing values
ch_clean = ch.dropna(subset=vars_needed_1).copy()
print("N after drop NA:", len(ch_clean))
ch_clean[vars_needed_1].describe()


# Check range of ESG and Return values
print("ESG range:", ch_clean["Total_ESG_Score"].min(), "-", ch_clean["Total_ESG_Score"].max())
print("Return range:", ch_clean["Annual_Return_Pct"].min(), "-", ch_clean["Annual_Return_Pct"].max())

# Industry representation
print("Industries:", ch_clean["Industry"].nunique())
print(ch_clean["Industry"].value_counts().head(10))
```

- The number of companies per industry reaches a maximum of 14, which is expected given the dataset of only 136 observations.
- ESG risk scores vary widely, from negligible to severe levels.
- The range of annual returns is also quite broad, with extreme outliers showing losses of up to -100% and gains exceeding +250%. We reviewed the outliers and excluded them for further analysis.

```{python}
#| label: annual-return-histogram-boxplot
# Histogram + Boxplot
fig, ax = plt.subplots(1, 2)

ax[0].hist(ch_clean["Annual_Return_Pct"], bins=40)
ax[0].axvline(0, linestyle="--")
ax[0].set_title("Histogram - Annual Return")
ax[0].set_xlabel("Annual Return (%)"); ax[0].set_ylabel("Count")

ax[1].boxplot(ch_clean["Annual_Return_Pct"].dropna(), vert=False, showfliers=True)
ax[1].set_title("Boxplot - Annual Return")
ax[1].set_xlabel("Annual Return (%)")

plt.tight_layout(); plt.show()
```

```{python}
#| label: remove-outliers
Q1 = ch_clean["Annual_Return_Pct"].quantile(0.25)
Q3 = ch_clean["Annual_Return_Pct"].quantile(0.75)
IQR = Q3 - Q1

lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR

print(f"Q1: {Q1:.2f}, Q3: {Q3:.2f}, IQR: {IQR:.2f}")
print(f"Lower bound: {lower_bound:.2f}, Upper bound: {upper_bound:.2f}")

ch_clean_no_outliers = ch_clean[
    (ch_clean["Annual_Return_Pct"] >= lower_bound) &
    (ch_clean["Annual_Return_Pct"] <= upper_bound)
].copy()

print(f"Removed {len(ch_clean) - len(ch_clean_no_outliers)} outliers")
print(f"Remaining observations: {len(ch_clean_no_outliers)}")
```


We create a scatterplot to analyse the relationship between ESG-risk and annual return visually:

```{python}
#| label: Annual-return-ESG-score
#| output: true
plt.figure()
sns.regplot(
    data=ch_clean_no_outliers,
    x="Total_ESG_Score",
    y="Annual_Return_Pct",
    scatter_kws={"alpha":0.5},
    line_kws={"color":"red"},
    ci=95
)
plt.title("Annual Return vs ESG Score", fontsize=11)
plt.xlabel("Total ESG Score")
plt.ylabel("Annual Return (%)")
plt.grid(alpha=0.3)
plt.tight_layout()
plt.show()
```

The linear fit is horizontal which means that there is no effect of ESG risk on annual performance. This result implies that firms with stronger ESG do not systematically outperform or underperform peers in terms of annual stock returns. </br>
The broad confidence band further suggests that ESG factors alone have limited explanatory power for short-term returns.


Now we run a regression analysis to statistically disentangle the effects and control for several influencing factors, such as:

- **Market capitalization** (log_mc): Larger firms are typically more diversified and stable, which can affect both their ESG performance and returns.
- **Revenue growth** (Revenue_Growth_Pct): Fast-growing firms may achieve higher returns regardless of ESG, so including growth helps isolate the ESG effect.
- **Industry**: ESG relevance differs by sector, so industry dummies control for these differences.

```{python}
#| label: how-many-obs-per-industry
# How many obs per industry?
counts = ch_clean_no_outliers["Industry"].value_counts()

# Keine Mindestanzahl mehr ‚Äì alle Industrien bleiben erhalten
df_fix = ch_clean_no_outliers.copy()
df_fix["Industry_grp"] = df_fix["Industry"]

# Refit with industry fixed effects
m_ret_clean = smf.ols(
    "Annual_Return_Pct ~ Total_ESG_Score + log_mc + Revenue_Growth_Pct + C(Industry_grp)",
    data=df_fix
).fit(cov_type="HC3")  # robust to heteroscedasticity

print(m_ret_clean.summary())
```

The adjusted R-squared shows that the model explains about 49% of the variance in annual returns.

Contrary to expectations from the visual analysis, the Total ESG Score has a statistically significant effect (coef = 0.91, p = 0.047), but in the opposite direction: higher ESG risk is linked to higher annual returns. The effect is small, with about a 0.9 percentage point increase in return per ESG-risk point.

Log market capitalization is highly significant (coef = 7.22, p < 0.001), indicating that larger firms tend to achieve higher returns, while revenue growth has no significant impact (coef = -0.03, p = 0.78).

## RQ2: Effect of industry type on financial performance and ESG relationship for top 5 Swiss industries

```{python}
#| label: significant-industries-revenue

top5 = [
    "Drug Manufacturers - General",
    "Packaged Foods",
    "Insurance - Diversified",
    "Banks - Diversified",
    "Insurance - Reinsurance"
]

plot_set = ch_clean_no_outliers[ch_clean_no_outliers["Industry"].isin(top5)].copy()


industry_counts = plot_set["Industry"].value_counts().to_dict()

g = sns.lmplot(
    data=plot_set,
    x="Total_ESG_Score",
    y="Annual_Return_Pct",
    col="Industry",
    col_wrap=3,
    height=2,
    scatter_kws={"alpha": 0.6, "s": 8}
)


g.set_axis_labels("Total ESG Score", "Annual Return (%)", fontsize=8)

for ax in g.axes.flat:
    industry = ax.get_title().split(" = ")[-1]  
    n = industry_counts.get(industry, 0)
    ax.set_title(
        f"{industry}\n(n={n})",
        fontsize=8,
        fontweight="bold",   
        pad=0
    )
    ax.grid(alpha=0.3)
    ax.tick_params(axis="both", labelsize=7)

plt.subplots_adjust(top=0.85)
g.fig.suptitle("Annual Return vs ESG Score ‚Äî Top 5 Industries", fontsize=11)
plt.show()
```

Based on the regression results from RQ1, none of the industry coefficients are statistically significant. This means that, after controlling for firm size, revenue growth, and ESG risk, there are no clear industry-specific effects on annual returns. All industry coefficients show large standard errors and high p-values, suggesting that differences across industries are not robust or meaningful in this model.

## RQ3: ESG Subdimensions and Financial Performance

This section examines whether the Environmental (E), Social (S), and Governance (G) 
pillars are linked to companies‚Äô financial outcomes ‚Äî measured by Return on Equity (ROE), P/E ratio, and Annual Return.

A correlation analysis shows that while E, S, and G scores are moderately correlated with each other (E‚ÄìS = 0.76, S‚ÄìG = 0.62), 
their relationships with financial indicators are weak or near zero. This suggests that ESG performance does not directly translate into stronger short-term financial results.

A multiple regression using ROE as the dependent variable confirms this pattern (R¬≤ = 0.005). None of the ESG components show statistically significant effects:

- Social: small positive coefficient (suggesting slightly higher profitability for socially engaged firms),
- Environmental and Governance: small negative effects.

```{python}
#| label: multiple-regression-for-roe
#| output: true
## Multiple regression for ROE

# Select and clean
cols = ['Environmental_Score', 'Social_Score', 'Governance_Score', 'ROE_Pct']
df_reg = (esg_clean[cols]
          .apply(pd.to_numeric, errors='coerce')  # ensure numeric types
          .dropna()
          .copy())

# Split X / y
X = df_reg[['Environmental_Score', 'Social_Score', 'Governance_Score']]
X = df_reg[['Environmental_Score', 'Social_Score', 'Governance_Score']]
y = df_reg['ROE_Pct']

# Standardize predictors and KEEP THE INDEX
scaler = StandardScaler()
X_scaled_np = scaler.fit_transform(X)
X_scaled = pd.DataFrame(X_scaled_np, columns=X.columns, index=X.index)

# Add constant term (no hasconst argument)
X_scaled = sm.add_constant(X_scaled)

# Fit regression
model = sm.OLS(y.loc[X_scaled.index], X_scaled).fit()
```

```{python}
#| label: build-dataframe-of-coefficients
#| output: true
# Build dataframe of coefficients (excluding constant)
coef_df = pd.DataFrame({
    'Variable': model.params.index[1:],  # skip constant
    'Coefficient': model.params.values[1:]
}).sort_values('Coefficient', ascending=False)

plt.figure(figsize=(6,4))
sns.barplot(
    data=coef_df,
    x='Variable',
    y='Coefficient',
    hue='Variable',         
    palette='viridis',
    legend=False
)
plt.axhline(0, color='gray', linestyle='--')
plt.title("Relative effect of E, S, G on ROE (standardized predictors)")
plt.tight_layout()
plt.show()
```

Although insignificant, the Social pillar consistently displays the most positive association, 
hinting that companies emphasizing social responsibility might experience marginal benefits. 
In contrast, stricter governance practices may correspond to slightly lower short-term returns.

Overall, ESG subdimensions explain less than 1% of ROE variation ‚Äî indicating that ESG effects on profitability are weak or long-term rather than immediate.

# RQ4: Comparison: Swiss vs. Global Companies

To assess country differences, we compare correlations and regression coefficients between Swiss SPI and global (S&P 500) firms.

```{python}
#| label: split-datasets
## Split datasets
df_swiss = esg_clean[esg_clean['Country'] == 'Switzerland']
df_global = esg_clean[esg_clean['Country'] != 'Switzerland']
```

```{python}
#| label: compare-regression-coefficients
#| output: true
## Compare Regression coefficients across groups

def regression_summary(data, y_var='ROE_Pct'):
    df_reg = data[['Environmental_Score','Social_Score','Governance_Score', y_var]].dropna()
    X = df_reg[['Environmental_Score','Social_Score','Governance_Score']]
    y = df_reg[y_var]
    X_scaled = StandardScaler().fit_transform(X)
    X_scaled = sm.add_constant(X_scaled)
    model = sm.OLS(y, X_scaled).fit()
    return model.params[1:]  # coefficients only

coef_swiss = regression_summary(df_swiss)
coef_global = regression_summary(df_global)

coef_compare = pd.DataFrame({
    'Variable': ['Environmental_Score','Social_Score','Governance_Score'],
    'Swiss': coef_swiss.values,
    'Global': coef_global.values
}).melt(id_vars='Variable', var_name='Region', value_name='Coefficient')

plt.figure(figsize=(6,4))
sns.barplot(data=coef_compare, x='Variable', y='Coefficient', hue='Region', palette='Set2')
plt.title("Comparison of ESG effects: Swiss vs Global")
plt.axhline(0, color='gray', linestyle='--')
plt.show()
```

Both samples show similar patterns: ESG dimensions correlate strongly among themselves but weakly with financial indicators. 
However, Swiss firms display a stronger positive Social‚Äìfinancial link (‚âà 0.29), 
suggesting that social initiatives may be more valued in Switzerland‚Äôs stakeholder-oriented context.

Regression comparisons confirm this tendency:

- Swiss firms: stronger positive Social effect, stronger negative Governance effect.
- Global firms: weaker and less consistent relationships.

Thus, while ESG scores are generally not significant predictors of financial performance, 
the Social pillar appears more relevant for Swiss firms, possibly reflecting local cultural or regulatory emphasis on corporate responsibility.

## Interpretation and Discussion

RQ1: ‚ÄúIs there a clear correlation between ESG and financial performance, and how do E, S, G factors compare in explaining it?‚Äù
Correlation Heatmap (Global sample)

The Total ESG Score shows moderate positive correlations with its subdimensions (E=0.76, S=0.62, G=0.23).

The correlations with financial performance metrics (ROE_Pct, Annual_Return_Pct) are very weak and slightly negative:

ROE vs. Total ESG: -0.065

Annual Return vs. Total ESG: -0.034
‚Üí This means no strong linear relationship between ESG scores and profitability or returns globally.

OLS Regression (Dependent: ROE_Pct)
Variable	Coefficient	p-value	Interpretation
Environmental_Score	-2.08	0.464	Negative but not significant
Social_Score	+2.25	0.420	Positive but not significant
Governance_Score	-3.06	0.288	Negative but not significant

R¬≤ = 0.005, meaning ESG dimensions together explain less than 1% of ROE variance.

None of the E, S, or G effects are statistically significant ‚Üí financial performance cannot be predicted by ESG subdimensions in this dataset.

Coefficient Visualization

The bar plot confirms:

Social factors have the most positive relative impact on ROE,

Governance shows the most negative,

Environmental has almost no effect.
However, none are significant ‚Äî so these are tendencies, not causal effects.

üü© Interpretation:
While the overall ESG score correlates moderately with itself across subdimensions, no clear link exists between ESG and financial performance in the global sample.
If any effect exists, social responsibility seems to have a more positive association with profitability than environmental or governance factors.

RQ2: ‚ÄúHow does the correlation between financial performance and ESG scores compare between Swiss companies and global competitors?‚Äù
Swiss Companies Correlation

Similar to the global sample, Total ESG is strongly correlated with its components (E=0.75, S=0.64, G=0.43).

The relationship with financial metrics remains very weak:

ROE vs. Total ESG: -0.097

Annual Return vs. Total ESG: -0.009

Slightly higher correlations between Social Score and returns (0.29) compared to global peers.

Comparative Bar Chart (Swiss vs Global)

Swiss firms: Strong positive Social impact (+7), strong negative Governance effect (-7).

Global firms: Weaker overall effects ‚Äî smaller Social impact (+1) and moderate negative Governance (-2).

Environmental effects are minor in both cases.

üü© Interpretation:
The direction of effects is consistent between Swiss and global firms, but the magnitude differs:

Swiss companies exhibit stronger positive responsiveness to Social factors and stronger negative sensitivity to Governance ones.

Global firms show weaker effects across all ESG dimensions.

This may reflect differences in:

Corporate governance structures and transparency expectations,

Market maturity,

Cultural emphasis on social responsibility in Switzerland.

4. ESG Subdimensions and Financial Performance

This section examines how environmental (E), social (S), and governance (G) dimensions relate to financial performance, measured through Return on Equity (ROE) and Annual Return.
Both correlation and OLS regression analyses were conducted for global and Swiss company samples.

Global Results

The correlation matrix indicates only weak relationships between ESG scores and financial performance.
While the Total ESG Score correlates strongly with its subcomponents (E=0.76, S=0.62, G=0.23), correlations with ROE and Annual Return are negligible.
The regression analysis confirms that none of the ESG dimensions significantly explain ROE (R¬≤ = 0.005).
Among the three, the Social dimension shows the most positive (though insignificant) effect, suggesting that socially responsible practices might slightly enhance profitability, whereas Governance and Environmental factors show small negative tendencies.

Swiss vs. Global Comparison

The correlation patterns for Swiss companies mirror the global results but with slightly stronger interactions.
Social and Governance factors have more pronounced coefficients in the Swiss sample:

Social factors appear more positively linked to ROE,

Governance shows a stronger negative relationship,

Environmental remains neutral.

Overall, no significant correlation between ESG and financial performance is found, but the direction and magnitude of ESG subdimension effects differ between Swiss and global companies.


# Conclusion
This project examined the relationship between corporate ESG performance and financial market outcomes, focusing primarily on Swiss companies and comparing them to global peers. Using comprehensive ESG and financial data from the Swiss Performance Index and S&P 500, we analyzed correlations and regression models to explore how ESG, its subdimensions, and industry context affect financial performance.

RQ1: Relationship between ESG and financial performance (Swiss companies)
The analysis revealed no strong or consistent relationship between ESG scores and short-term financial returns. Regression results even showed a weak negative link between ESG risk and annual return, suggesting that higher ESG risk might correspond to marginally higher returns, although the effect is small and not economically meaningful. Thus, ESG performance does not appear to drive financial outperformance among Swiss firms in the short run.

RQ2: Industry effects within Switzerland
When controlling for company size and growth, no significant differences across industries were found. This implies that ESG-related financial effects are not industry-specific in the Swiss market ‚Äî rather, the ESG-performance relationship is weak and homogeneous across sectors.

RQ3: Individual ESG subdimensions (E, S, G)
The Environmental, Social, and Governance components all showed weak correlations with financial indicators such as ROE and Annual Return. None of the dimensions significantly explained profitability in the regression models. However, Social factors displayed the most positive (though insignificant) coefficients, hinting that socially responsible practices might slightly support profitability, whereas Governance and Environmental factors tended to have small negative impacts.

RQ4: Comparison between Swiss and global companies
Swiss firms and global peers exhibited similar overall patterns: no statistically significant link between ESG and financial results. Yet, Swiss companies showed a somewhat stronger positive association between the Social dimension and financial performance, possibly reflecting the country‚Äôs cultural emphasis on stakeholder responsibility and social trust. Governance effects were more negative in Switzerland, suggesting that stricter governance standards might constrain short-term returns.

Overall Conclusion
Across all analyses, ESG performance does not emerge as a significant short-term driver of financial success. The relationship between ESG and profitability appears weak and context-dependent, with the social dimension showing the most promise as a positive contributor, particularly among Swiss firms. This supports the view that ESG benefits may materialize more in the long term, through reputational strength, risk mitigation, and stakeholder trust, rather than immediate financial gains.

# References
